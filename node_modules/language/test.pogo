dsl = require './index'

migrations(block) =
    migrations = []

    m = dsl {
        migration (name, block) =
            migrations.push {name = name, migration = updown (block)}
    }

    updown (block) =
        up = nil
        down = nil

        b = dsl {
            up (block) =
                up := block

            down (block) = down := block
        }

        b(block)

        { up = up, down = down }

    rql = dsl {
        r = 'this is r'
    }

    m(block)

    console.log 'migrations'
    for each @(migration) in (migrations)
        console.log "migration \"#(migration.name)\""
        console.log (rql (migration.migration.up))

migrations
    migration 'some table'
        up
            r
